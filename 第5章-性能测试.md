# 第5章-性能测试

互联网的发展使人们对软件产品与网络的依赖性越来越大，同时也加快了人们生活和工作的节奏，为了追求高质量、高效率的生活和工作，人们对软件产品的性能要求越来越高，例如软件产品要足够稳定、响应速度要足够快，在用户量、工作量较大时也不会出现崩溃或卡顿等现象。人们对软件产品性能的高要求，使得软件的性能测试越来越受到测试人员的重视。

性能测试是度量软件质量的一种重要方式，它从软件的响应速度、稳定性、兼容性、可移植性等方面检测软件是否满足用户需求。作为软件测试人员，性能测试是必须要掌握的测试技能之一。本章将对性能测试的相关知识进行详细讲解。



## 5.1 性能测试概述

### 5.1.1 性能测试简介

性能测试是通过性能测试工具模拟正常、峰值和异常负载条件来对系统的各项性能指标进行测试。性能测试能够验证软件系统是否达到了用户期望的性能需求，同时也可以发现系统中可能存在的性能瓶颈和缺陷，从而优化系统的性能。



<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250419114349231.png" alt="image-20250419114349231" style="zoom:67%;" />

在进行性能测试时，首先需要确定性能测试的目的，然后根据性能测试的目的制定测试方案。通常情况下性能测试的目的主要有以下4个方面。

（1）验证系统性能是否满足预期的性能需求，包括系统的执行效率、稳定性、可靠性、安全性等。

（2）分析软件系统在各种负载水平下的运行状态，提高性能调整效率。

（3）识别系统缺陷，寻找系统中可能存在的性能问题，定位系统性能瓶颈并解决问题。

（4）进行系统调优，通过重复的、长时间的测试，找出系统中存在的隐含问题，改善并优化系统的性能。



性能测试除了能为企业提供软件系统的执行效率、稳定性、可靠性等信息外，更重要的是它还能指出产品在上线之前需要做哪些改进



### 5.1.2 性能测试种类

系统的性能覆盖面非常广，包括执行效率、资源占用、系统稳定性、安全性、兼容性、可靠性、可扩展性等。

性能测试是一个统称，它包含很多种类，例如基准测试、负载测试、压力测试、并发测试、配置测试、稳定性测试、容量测试等，每种测试都有其侧重点。

#### 1.基准测试

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421144048223.png" alt="image-20250421144048223" style="zoom:67%;" />

从狭义上将，**基准测试是指单用户测试**，即测试环境确定后，使用单个用户对业务模型中的重要业务做多次单独的测试，观察并记录各项性能指标的变化。例如，同一个用户登录10次软件以测试登录所需时间，最后得出10次登录平均所需时间为3秒，这就是一次基准测试。



从广义上讲，基准测试是一种测量和评估软件性能指标的测试。在某个时刻通过基准测试建立一条基准线，当系统的软硬件环境发生变化后，再进行测试以确定软硬件环境变化对软件性能的影响。例如，对于某商场1.0版本，模拟5万用户同时下单，硬件配置为8个CPU、16G内存，下单响应时间为3秒。以此基准线为标准，不该表其他条件，分别模拟10万、20万等多组用户的下单响应时间。



基准测试一般不会单独存在，它通常为多用户并发测试等提供参考依据，为系统配置、环境配置、系统优化前后的性能变化提供参考指标。

#### 2.负载测试

**负载测试**是指逐步增加系统负载（如逐渐增加模拟用户数量）来测试系统性能的变化，并最终确定在满足系统性能指标的情况下，系统所能够承受的最大负载。负载测试类似于举重运动，通过不断给举重运动员增加重量，确定运动员在身体允许的情况下所能举起的最大重量。

进行负载测试的前提是满足性能指标要求。例如一个软件系统的响应时间要求不超过 2 秒，则在这个前提下，不断增加用户访问量，当访问量超过 1 万人时，系统的响应时间就会变慢，并超过 2 秒，即可以确定系统响应时间不超过 2 秒的前提下最大负载是 1 万人。



#### 3.压力测试

压力测试也叫强度测试，是指让系统超负荷运行，使系统某些资源达到饱和或接近系统崩溃的边缘，以测试系统的性能变化，从而确定系统所能承受的最大压力。压力测试可以暴露那些只有在高负载条件下才会出现的Bug，例如同步问题、内存泄露等。



压力测试与负载测试是有区别的，负载测试的目的是在满足性能指标要求的前提下，测试系统能够承受的最大负载，而压力测试的目的则是测试使系统性能达到极限的状态。

例如软件系统正常的响应时间为 2 秒，通过负载测试确定用户访问量超过 1 万人时响应时间变慢。对于压力测试，则继续增加用户访问量，观察系统的性能变化，当用户访问量增加到 2 万人时系统响应时间为 3 秒，当用户访问量增加到 3 万人时响应时间为 4 秒，当用户访问量增加到 4 万人时，系统崩溃无法响应。由此确定系统能承受的最大访问量为 4 万人。



**小提示：**

性能测试中还有一种压力测试叫做峰值测试，它是指瞬间（非逐步加压）将系统压力加载到最大，测试软件系统在极限压力下的运行情况。峰值测试的情况多见于“秒杀” “双十一”等活动。



#### 4.并发测试

**并发测试是指通过模拟用户并发访问**，测试多用户并发访问同一个应用、同一个模块或者数据记录时是否存在死锁、响应慢或其他性能问题。并发测试一般没有标准，只是测试并发时会不会出现意外情况。几乎所有的性能测试都会涉及并发测试，例如多个用户同时访问某一条件数据或多个用户同时更新数据，那么数据库可能就会出现访问错误、写入错误等异常情况。



#### 5.配置测试

配置测试是指调整软件系统的软硬件环境，测试各种环境对系统性能的影响，从而找到系统各项资源的最优分配原则。配置测试不改变代码，只改变软硬件配置，例如安装版本更高的数据库、配置性能更好的CPU和内存等，其通过更改外部配置来提高软件的性能。



#### 6.稳定性测试

稳定性测试也称为可靠性测试，它是指让系统在强负载情况下，持续运行一段时间（如724小时），测试系统在这种条件下是否能够稳定运行。由于系统在强负载下有业务压力且运行时间较长，所以稳定性测试可以检测系统是否存在内存泄露等问题。



#### 7.容量测试

容量测试是指在一定的软硬件及网络环境下，测试系统所能支持的最大用户数、最大存储量等。容量测试通常与数据库、系统资源（如CPU、内存、磁盘等）有关，用于规划将来需求增长（如用户增长、业务量增加等）时，对数据库和系统资源的优化。



### 5.1.3 性能测试指标

性能测试不同于功能测试，功能测试只要求测试软件的功能是否实现，而**性能测试要求测试软件功能的执行效率是否达到要求**。例如某个软件具备**查询功能**，功能测试只测试查询功能是否实现，而性能测试却要求测试查询功能的**响应时间是否足够准确、快速**。但是，对于性能测试来说，多快的查询速度才算足够快， 什么样的查询情况才算足够准确是很难界定的。因此，我们需要一些**指标**来量化这些数据。

性能测试常用的指标包括**响应时间、吞吐量、并发用户数、QPS**（Queries Per Second，每秒查询数）和**TPS**（Transactions Per Second，每秒事务数）等。



#### 1.响应时间

**响应时间（Response Time）是指系统对用户请求作出响应所需要的时间。**这个时间是指用户从客户端发出请求到用户接收到返回数据的整个过程所需要的时间，包括各种中间件（如服务器、数据库等）的处理时间。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421171848891.png" alt="image-20250421171848891" style="zoom:67%;" />

系统的响应时间会随着访问量的增加、业务量的增加等变长，在进行性能测试时，除了测试系统的正常响应时间是否达到要求外，还会测试在一定压力下系统响应时间的变化。



#### 2.吞吐量

**吞吐量（Throughput）是指单位时间内系统能够完成的工作量，**它衡量的是**软件系统服务器的处理能力**。吞吐量的度量单位可以是请求数/秒、页面数/秒、访问人数/天、处理业务数/小时等。

吞吐量是软件系统衡量自身负载能力的一个很重要的指标，**吞吐量越大，系统单位时间内处理的数据就越多，系统的负载能力就越强**。



#### 3.并发用户数

**并发用户数是指在同一时间内请求和访问的用户数量。**例如对于某一软件，同时有 100 个用户请求登录， 则其并发用户数就是 100。并发用户数越大，其对系统的性能影响越大，并发用户数较大可能会导致**系统响应变慢、系统不稳定等**。
软件系统在设计时必须要考虑并发访问的情况，测试人员在进行性能测试时也必须进行并发访问的测试。



#### 4.QPS和TPS

QPS  是指**系统每秒能够响应的查询次数**，用于衡量特定的查询服务器在规定时间内能够处理的流量。TPS 是指**系统每秒能够处理的事务数量**。一个事务可以包含多个请求。
如果对一个查询接口进行压力测试，且这个接口内部不会再去请求其他接口，那么 TPS 与QPS 没有区别；如果对一个事务进行操作，该事务中包含了 n 个查询接口，且这些接口内部都不会再去请求其他接口， 那么此时的 QPS=n×TPS。



#### 5.点击率

**点击率（Hits Per Second）是指用户每秒向Web服务器提交的HTTP请求数量**，这个指标是Web应用特有的一个性能指标，通过点击率可以评估用户产生的负载量，并且可以判断系统是否稳定。点击率只是一个参考指标，用于辅助衡量Web服务器的性能。



#### 6.错误率

**错误率是指系统在负载情况下，失败业务的概率。**错误率是一种性能指标，不是功能上的随机Bug，大多数系统都会要求错误率无限接近于0。



#### 7.资源利用率

**资源利用率是指软件对系统资源的使用情况**，包括**CPU利用率、内存利用率、磁盘利用率**等，资源利用率是分析软件性能瓶颈的重要参数。
例如某一个软件，预期最大访问量为 1 万，但是当达到 6000 访问量时内存利用率就已经达到 80%，限制了访问量的增加，此时就需要考虑软件是否有内存泄漏等缺陷，从而进行优化。



## 5.2 搭建性能测试环境

### 5.2.1 安装配置JDK



### 5.2.2 安装JMeter

登录Apache JMeter官网,单击“apache-jmeter-5.4.3.zip sha512 pgp”下载链接下载JMeter。 JMeter官网首页如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421174750602.png" alt="image-20250421174750602" style="zoom:67%;" />

下载完成之后，JMeter无须安装，解压即可使用。解压之后，在bin目录下，有一个jmeter.bat文件，双击该文件就可以启动JMeter。JMeter启动成功界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421174829222.png" alt="image-20250421174829222" style="zoom:67%;" />

至此，JMeter安装完成。



### 5.2.3 JMeter目录

JMeter解压之后，其目录如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421174939754.png" alt="image-20250421174939754" style="zoom:67%;" />

#### 1.bin目录

bin目录用于存储可执行文件和配置文件，bin目录中的内容如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421175027939.png" alt="image-20250421175027939" style="zoom:67%;" />

#### 2.docs目录

docs目录为接口文档目录，该目录主要用于存储JMeter官方的API文档，用于二次开发。在docs/api目录下的index.html文件中，可以查找类名、包名的使用方法。



#### 3.extras目录

extras目录为扩展插件目录，该目录存储的是JMeter与其他工具集成所需要的一些组件。例如，extras目录下有ant-jemter-1.1.1.jar包，说明JMeter可以集成Apache Ant自动化测试工具。



#### 4.lib目录

lib目录主要用于存储JMeter依赖的JAR包和用户扩展（第三方）所依赖的JAR包。lib目录下存储的是JMeter自带的JAR包，用户扩展所依赖的JAR包存储在lib目录下的ext文件夹中。



#### 5.licenses目录

licenses目录存储的是JMeter的软件许可证，在licenses目录下可以查看软件许可证文件。



#### 6.printable_docs目录

printable_docs目录存储的是JMeter官方的帮助文档，在printable_docs目录下的index.html文件中，可以查看官方的帮助文件。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421180029690.png" alt="image-20250421180029690" style="zoom:67%;" />



<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421180104626.png" alt="image-20250421180104626" style="zoom:67%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250421180159226.png" alt="image-20250421180159226" style="zoom:67%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422110503541.png" alt="image-20250422110503541" style="zoom:67%;" />

## 5.3 第一个JMeter测试

下面将通过JMeter向百度网站发送一个请求，实现JMeter的第一个测试，以演示JMeter的使用。



### 1.添加测试计划

测试计划是JMeter的根元素，也是JMeter的管理单元。JMeter中的所有测试内容都基于测试计划，每一个测试计划都可以模拟一定的特定场景，用户可以通过添加各种元件制定测试计划。

每次启动JMeter，主界面都默认有一个空的测试计划。用户也可以在菜单栏单击“文件”在弹出的下拉菜单中选择“新建”选项，添加测试计划。添加测试计划之后，将其命名为第一个测试计划 ，按“Ctrl+S”组合键保存测试计划，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422111006409.png" alt="image-20250422111006409" style="zoom:67%;" />

### 2.添加线程组

保存好测试计划后便可添加线程组，线程组是测试计划的入口。如下图所示，右键单击JMeter主界面左侧的“测试计划-第一个测试计划”，在弹出的快捷菜单中依次选择“添加”->“线程（用户）”-> “线程组”。

选中JMeter主界面的“测试计划-第一个测试计划”并右键单击，在弹出的快捷菜单中依次选择“添加”→“线程（用户）”→“线程组”，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422111047420.png" alt="image-20250422111047420" style="zoom:67%;" />

在上图中，“线程（用户）”后有3个线程组选项，分别是“setUp线程组”、“tearDown线程组”、“线程组”，这3个线程组的含义与作用分别如下。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422111109837.png" alt="image-20250422111109837" style="zoom:67%;" />

- setUp线程组

一种特殊类型的线程组，用于执行测试前的初始化操作。例如：测试购物网站在购物之前需要先登录，登录操作就可以在setUp线程组中配置。setUp线程组的执行顺序在普通线程组之前。

- tearDown线程组

一种特殊类型的线程组，用于执行测试结束之后的回收工作。例如：测试购物网站在购物之后需要退出登录，退出登录操作就可以在tearDown线程组中配置。tearDown线程组的执行顺序在普通线程组之后。

- 线程组

普通线程组，一个线程组可以表示一个虚拟用户组，线程组中可以设置线程数量，每一个线程都可以模拟一个虚拟用户。



setUp线程组、tearDown线程组、线程组的主要配置项都相同，下面以线程组为例讲解主要配置项。单击“线程组”选项添加线程组，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422113042381.png" alt="image-20250422113042381" style="zoom:67%;" />

线程组的主要配置项的含义与作用如下。

- 名称：用于为线程组命名。
- 线程数：用于设置线程数量，即要模拟多少个用户。
- Ramp-Up时间（秒）：用于设置线程全部启动的时间。例如，若线程数设置为100，Ramp-Up时间设置为5，表示在5秒内启动100个线程，每秒启动的线程数量为20（100/5）。
- 循环次数：用于设置线程循环次数。如果勾选了“永远”选项，则线程会一直循环。
- 调度器：用于打开时间调试配置。勾选该复选框后，下方的“持续时间（秒）”和“启动延迟（秒）”才能设置。
- 持续时间（秒）：用于设置线程组测试的持续时间。如果设置了持续时间，则以该时间为准，时间到则线程组测试结束，即使在循环次数中勾选了“永远”复选框，线程也不会一直循环。需要注意的是，持续时间设置的时间要比Ramp-Up设置的时间长，否则线程还未全部启动，测试就结束了。
- 启动延迟（秒）：表示启动测试后多久开始创建线程，通常用于定时。

在本案例中，不需要额外配置，保持默认即可。在实际测试过程中，一个测试计划可以添加多个线程组，用户可以根据测试需求配置线程组的配置项。



### 3.添加HTTP请求

HTTP请求是用于发送请求的元件。选中“线程组”并右键单击，在弹出的快捷菜单中依次选择“添加”→“取样器”→“HTTP请求”，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422113417932.png" alt="image-20250422113417932" style="zoom:67%;" />

在上图中，单击“HTTP请求”选项完成HTTP请求的添加，HTTP请求添加成功的界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422113444443.png" alt="image-20250422113444443" style="zoom:67%;" />



在上图中，配置要发送的请求，例如请求百度网站，并将请求的协议、服务器名称或IP地址、端口号、请求方式、路径等信息配置到HTTP请求中。本次只是向百度发送一次请求，只需配置协议、服务器名称或IP即可，配置信息如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422113737992.png" alt="image-20250422113737992" style="zoom:67%;" />

### 4.添加察看结果树

完成HTTP请求的配置之后，即可发送请求，但为了查看请求的结果信息，需要添加查看结果的元件，本次添加查看结果树元件以查看请求结果。在上图中，选中“线程组”并右键单击，在弹出的快捷菜单中依次选择“添加”→“监听器”→“察看结果树”，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422114225781.png" alt="image-20250422114225781" style="zoom:67%;" />

查看结构树添加成功界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422114302199.png" alt="image-20250422114302199" style="zoom:67%;" />

### 5.执行测试

查看结构树添加成功后，在上图中单击工具栏中的启动按钮“<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422114826927.png" alt="image-20250422114826927" style="zoom:67%;" />“，JMeter就会发送请求，并接收百度服务器返回的结果。请求与返回结果的信息可以在察看结果树中查看，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422114900059.png" alt="image-20250422114900059" style="zoom:67%;" />

在上图中，查看结果树种，选中发送的请求，右侧就会出现请求相关的数据，通过“取样器结果”  “请求” “响应数据” 标签，可以查看请求和响应的相关数据。例如：单击“请求“标签，可以查看到JMeter发送的请求为GET请求，URL为http://www.baidu.com。

至此，第一个JMeter测试完成。



### 小提示：

元件是指JMeter中的一个无法拆分的子功能。组件是指一组具有相似功能的元件的集合。例如，取样器是一个组件，用于发送请求，在这个组件中有各种各样的元件，这些元件用于发送不同的请求，其中HTTP请求就是一个非常常用的元件。监听器也是一个组件，用于监听请求返回的结果。在监听器中，有多个监听结果的元件，例如察看结果树、汇总报告、聚合报告等。



## 5.4 JMeter核心组件



在实际测试工作中，一个测试计划往往很复杂，需要添加多个元件并对其进行配置。在添加元件之前，首先需要明确元件所归属的组件，即明确元件的位置和作用。JMeter有8个核心组件，每个组件下都有多个元件。

### 5.4.1 取样器

**取样器**也称为**采样器**，它用于模拟用户操作，向服务器发送请求并接收服务器的响应数据。JMeter支持不同类型的取样器，例如**HTTP请求、FTP请求、Java请求**等，不同类型的取样器可以通过设置参数向服务器发送不同的请求。

取样器用于**模拟用户向服务器发送请求**，可以通过线程组添加取样器。最常用的取样器为**HTTP请求**，下面以HTTP请求为例，讲解取样器的配置。首先在JMeter主界面的测试计划中添加一个线程组，然后选中该线程组并右键单击，在弹出的快捷菜单中依次选择“添加”->"取样器" -> "HTTP请求"，会出现一个HTTP请求界面，然后在该界面配置HTTP请求的信息，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422115903334.png" alt="image-20250422115903334" style="zoom:67%;" />

HTTP请求的基本配置项如下。

- 名称：可以给HTTP请求命名。
- 协议：用于设置HTTP请求的协议。HTTP请求有两种协议，HTTP协议和HTTPS协议，用户可以根据实际测试场景设置协议。如果不设置协议，JMeter默认使用HTTP。
- 服务器名称或IP：用于设置请求地址，例如www.baidu.com。
- 端口号：用于设置请求的端口号。HTTP的默认端口号为80，HTTPS的默认端口号为443。
- HTTP请求方式：在“协议”下方有一个“GET”字样的配置项，该配置项用于设置HTTP请求方式。HTTP请求方式主要有GET（查找）、POST（提交）、PUT（更新）、DELETE（删除），用户可以根据实际测试场景选择合适的请求方式。
- 路径：用于设置请求的接口地址。
- 内容编码：一般设置为UTF-8。
- 参数：用于设置请求参数。当请求地址中需要携带参数时，可以单击下方的“添加”按钮添加一个键值对输入栏，输入相应的键和值（参数）。
- 消息体数据：也用于设置请求参数。当在请求体中传递参数时，可以将请求中的参数以JSON格式写在“消息体数据”下方的空白处。
- 文件上传：可以将请求中携带的参数以文件的形式进行传递。以文件上传形式传递参数时，可以单击下方的“添加”按钮添加一个键值对输入栏，输入文件名称和要传递的参数。



下面通过两个小案例演示HTTP请求的配置。第1个案例要求使用JMeter发送一个GET请求，请求地址为http://www.baidu.com/S?wd=test，要求分别使用路径和参数列表这两种方式传递GET请求参数。



分析上述请求要求可知，请求方式为GET，请求协议为HTTP，服务器名称或IP地址为http://www.baidu.com/S?wd=test。由于请求协议为HTTP，所以端口号为80。当使用路径传递参数时，直接将测试/S?wd=test写在路径中即可；当使用参数列表传递参数时，在路径配置中配置/S，参数wd=test则以参数列表的形式配置。



明确了上述信息，下面分别在JMeter中添加HTTP请求，使用路径传递参数的HTTP请求界面和使用参数列表传递参数的HTTP请求界面如下图：

![image-20250422120846360](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422120846360.png)



下面演示第2个案例，本案例要求使用JMeter发送一个POST请求，请求地址为https://www.baidu.com/S?wd=test，要求使用消息体数据传递POST请求的参数。

分析上述要求可知，请求方式为POST，请求协议为HTTPS，服务器名称或IP地址为www.baidu.com/S?wd=test。由于请求协议为HTTPS，所以端口号为443。使用消息体传递参数时，配置路径只配置/S，参数wd=test写在“消息体数据”下方的空白处。

明确了上述信息，使用消息体传递POST请求参数的HTTP请求界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422155948688.png" alt="image-20250422155948688" style="zoom:67%;" />

### 5.4.2 监听器

监听器主要用于**监听JMeter的测试结果**，监听器可以将测试结果以**表格**或**图形**的形式展现给用户，也可以将测试结果保存到文件中，供用户再次分析时使用。监听器可以在**测试计划的任何位置添加**，包括直接在测试计划下面添加或在线程组下面添加。监听器只能**监听、收集同层级或下层级元件的数据**，因此，在不同层级添加的监听器的监听范围不同。



JMeter 常用的监听器为察看结果树和聚合报告。

#### 1.察看结果树

察看结果树通常在调试脚本的时候用于观察请求和响应结果是否正确，包括请求头、请求体、响应头、响应体。查看结果树可以在测试计划中添加，也可以在线程组中添加。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422160525865.png" alt="image-20250422160525865" style="zoom:80%;" />

##### （1）在测试计划中添加察看结果树

在JMeter主界面选中测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”“监听器”“察看结果树”，会添加一个察看结果树界面，也就是一个察看结果树。

##### （2）在线程组中添加察看结果树

在JMeter主界面的测试计划中首先添加线程组，然后选中线程组并右键单击，在弹出的快捷菜单中依次选择“添加”“监听器”“察看结果树”，会添加一个察看结果树界面。

在测试计划中和在线程组中添加察看结果树的界面是相同的，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422160811687.png" alt="image-20250422160811687" style="zoom:80%;" />

上图中，请求中的请求头和请求体是分开显示的，这样就更加清晰明了。察看结果树界面有“取样器结果”“请求”“响应数据”3 个选项卡，这 3 个选项卡的作用分别如下。

- 取样器结果：可以查看请求的整体性能指标，例如发送请求的线程名称、请求开始时间、加载时间、延迟时间等。
- 请求：其下有两个子选项卡，分别是“Request Body”和“Request Headers”。“Request Body”为请求体，可以查看请求体信息；“Request Headers”为请求头，可以查看请求头信息。
- 响应数据：其下也有两个子选项卡，分别是“Request Body”和“Request Headers” ，“Response Body”为响应体，可以查看响应体数据；“Response Headers”为响应头，可以查看响应头数据。



下面通过一个案例演示查看结果树的使用。在5.4.1小节取样器列举的两个案例的基础上添加两个察看结果树，第一个察看结果树从测试计划添加，第二个察看结果树从名称为“使用路径传递GET请求参数”的线程组添加。添加成功之后，发送请求并查看测试结果，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422161553927.png" alt="image-20250422161553927" style="zoom: 67%;" />

添加成功之后执行测试，察看结果树-1的界面和察看结果树-2的界面分别如下图所示。

![image-20250422161649002](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422161649002.png)

从上图中可知，查看结果树-1显示了3个请求的结果，查看名称为“HTTP请求-使用消息体数据传递POST请求参数”的HTTP请求，其请求数据为wd=test.

从上图中可知，查看结果树-2只显示名称为“HTTP请求-使用路径传递GET请求参数”的HTTP请求结果，该请求结果的响应状态为OK，说明请求发送成功。



#### 2.聚合报告

**聚合报告**用于测试结束后，**收集系统各项性能指标**，例如**响应时间、并发数、吞吐量**等。添加聚合报告的方式与添加察看结果树的方式相似，首先选中JMeter主界面的测试计划或线程组并右键单击，在弹出的快捷菜单中依次选择“**添加” “监听器” “聚合报告**”，聚合报告界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422162335475.png" alt="image-20250422162335475" style="zoom:67%;" />

下面结合上图介绍聚合报告中的各项指标。

- Label：请求的类型，例如HTTP请求、FTP请求、Java请求等。
- 样本：发送到服务器的请求数量。
- 平均值：请求的平均响应时间，单位是毫秒。
- 中位数：是一个时间值，单位是毫秒。有50%的请求响应时间低于该值，有50%的请求响应时间高于该值。例如，中位数为10，表示有50%的请求在10毫秒内响应，有50%的请求响应时间超过10毫秒。
- 90%百分位：90%的请求的响应时间少于该时间，单位是毫秒。
- 95%百分位：95%的请求的响应时间少于该时间，单位是毫秒。
- 99%百分位：99%的请求的响应时间少于该时间，单位是毫秒。
- 最小值：请求响应的最小时间，单位是毫秒。
- 最大值：请求响应的最大时间，单位是毫秒。
  异常：请求的错误率。
- 吞吐量：服务器单位时间内处理的请求数量。默认情况下是每秒（sec）处理的请求数量，通常认为吞吐量就是TPS。
- 接收KB/sec：每秒从服务器接收到的数据量。
- 发送KB/sec：每秒发送的数据量。

在上述指标中，平均值是一个比较常用的指标，但是90%百分位对测试而言更有参考价值，它说明90%的用户都能在这个时间内得到响应。95%百分位、99%百分位更精确，对测试结果的说明也更准确。



下面通过一个案例演示**聚合报告的使用**，本案例要求使用JMeter发送一个GET请求，请求地址为https://www.itcast.cn，模拟**50个用户**发送请求，在**5秒内**全部启动，运行时间为1分钟，查看并分析请求**响应时间、吞吐量、错误率**等性能指标，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422162840789.png" alt="image-20250422162840789" style="zoom:67%;" />

为了模拟**50个用户**发送请求，在**5秒内**启动全部线程，运行时间为1分钟，需要配置线程组。首先在测试计划中创建一个线程组，线程组的配置信息如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422163045450.png" alt="image-20250422163045450" style="zoom:67%;" />

在上图中，配置好HTTP请求和线程组之后，选中JMeter主界面的“线程组”并右键单击，在弹出的快捷菜单中依次选择“添加”→“监听器”→“聚合报告”，会添加一个聚合报告，添加成功后执行测试。当测试结束后，聚合报告结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250422163155249.png" alt="image-20250422163155249" style="zoom:80%;" />

由上图可知，在本次测试中，请求的响应时间平均值为980毫秒，90%的用户能够在1994毫秒内得到响应，服务器处理47.9个请求。在实际测试工作中，测试人员可以通过分析聚合报告结果，评估系统性能是否满足测试要求。



### 5.4.3 配置元件

性能测试中为了模拟大量用户操作，往往需要进行参数化，JMeter中的参数化可以通过配置元件完成。配置元件可以配置测试计划的一些公用信息（参数），其配置会影响作用域内的所有元件。

配置元件常用的参数化工具有**用户定义的变量**、**HTTP 信息头管理器**、**HTTP 请求默认值**、**CSV 数据文件设置**和**计数器**。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250423143046805.png" alt="image-20250423143046805" style="zoom:67%;" />

#### 1.用户定义的变量

**用户定义的变量可以被其作用域范围内的所有元件引用。**如果在测试计划中需要使用用户定义的变量，则可以选中JMeter主界面的测试计划并**右键单击**，在弹出的快捷菜单中依次选择“**添加**” -> “**配置元件**” -> “**用户定义的变量**”，会添加一个用户定义的变量界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250423143223342.png" alt="image-20250423143223342" style="zoom:67%;" />

在上图所示的界面中，单击下方的“添加”按钮可以添加一个输入栏，用于输入相应的变量名和值。当定义好变量之后，其他元件就可以引用变量实现参数化。其他元件引用变量的格式如下。

~~~properties
${变量名}
~~~

下面通过一个案例演示用户定义的变量的使用，本案例要求使用JMeter发送一个GET请求，请求地址为https://www.baidu.com:443，通过用户定义的变量定义变量protocol（协议）、domain（域名）和port（端口），使用这3个变量实现请求的参数化。

下面在线程组中添加用户定义的变量，并定义protocol、domain、port这3个变量。首先在JMeter主界面添加一个线程组，然后选中该线程组并右键单击，在弹出的快捷菜单中依次选择 “添加”->"配置元件"->"用户定义的变量",会添加一个用户定义的变量界面，在该界面定义变量protocol、domain和port。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424083631806.png" alt="image-20250424083631806" style="zoom: 80%;" />

在上图中，定义好变量之后，在线程组中添加一个HTTP请求界面，在该界面引用用户定义的变量protocol、domain和port。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424085052173.png" alt="image-20250424085052173" style="zoom:85%;" />

在上图所示的界面中，HTTP请求的协议、服务器名称或IP地址、端口号不再写成固定值，而通过引用变量配置各项参数。引用完变量后，在线程组中添加一个查看结果树界面，接着单击工具栏中的启动按钮“<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424085304554.png" alt="image-20250424085304554" style="zoom:50%;" />”，执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424085353059.png" alt="image-20250424085353059" style="zoom:67%;" />

由上图可知，“Request Body”(请求体)下方显示的请求地址与案例要求中的地址一致，说明HTTP请求成功。



#### 2.HTTP信息头管理器

**HTTP信息头管理器用于配置HTTP请求头信息**，例如请求体的MIME（Multipurpose Internet Mail Extensions，多用途互联网邮件扩展）类型**Content-Type**、浏览器可接受的响应内容类型Accept等。

HTTP请求头字段可以在HTTP信息头管理器中设置，如果想要在测试计划中添加HTTP信息头管理器，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择**“添加” -> “配置元件” -> “HTTP信息头管理器”**，会添加一个HTTP信息头管理器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424085752963.png" alt="image-20250424085752963" style="zoom:67%;" />

在上图中，单击下方的“添加”按钮可以增加一行输入栏，可将HTTP请求头字段及其值填写在输入栏中。HTTP信息头管理器的使用比较简单，下面通过一个案例演示**HTTP信息头管理器**的使用。本案例要求使用JMeter发送一个GET请求，请求地址https://www.baidu.com，在HTTP请求头中进行如下配置。

~~~properties
Content-Type:application/json;charset=utf-8
Accept:text/plain
~~~

下面在JMeter中构建测试目录，首先选中JMeter主界面的线程组并右键单击，在弹出的快捷菜单中依次选择 “添加”-> “配置元件” -> "HTTP信息头管理器"，会添加一个HTTP信息头管理器界面，然后再该界面对**HTTP信息头进行配置**，如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424090310730.png" alt="image-20250424090310730" style="zoom:80%;" />

当HTTP信息头管理器配置完成后，在线程组中添加一个HTTP请求，按照案例要求配置HTTP请求，如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424090440110.png" alt="image-20250424090440110" style="zoom: 80%;" />

配置完HTTP请求信息后，执行测试计划，添加察看结果树中的请求头数据如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424090522323.png" alt="image-20250424090522323" style="zoom:67%;" />

由上图可知，HTTP请求发送成功，请求头的数据与 “**HTTP信息头的配置**” 图中的请求头数据相同，说明通过HTTP信息头管理器可以设置请求头数据。



#### 3.HTTP请求默认值

如果一组请求的服务器名称、端口、请求方式都相同，则可以添加HTTP请求默认值，将请求的服务器名称、端口、请求方式配置在HTTP请求默认值中进行统一管理。如果想要在测试计划中添加HTTP请求默认值，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加” -> “配置元件” -> “HTTP请求默认值”，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424090858612.png" alt="image-20250424090858612" style="zoom:67%;" />

由上图可知，HTTP请求默认值界面与HTTP请求界面大致相同，它可以统一管理HTTP请求的共同信息，从而可以大幅提升请求的复用性。



#### 4.CSV数据文件设置

使用JMeter进行测试时，如果参数数据较多，可以将参数写入文件中，设置CSV数据文件可以从文件中读取参数。如果想要在测试计划中对CSV数据文件进行设置，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加” -> “配置元件” -> “CSV Data Set Config”，会添加一个CSV数据文件设置界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424091154078.png" alt="image-20250424091154078" style="zoom:67%;" />

CSV数据文件设置的主要配置项如下。

- 文件名：数据文件名，包括路径。
- 文件编码：文件的编码格式，通常是UTF-8。
- 变量名称（英文逗号隔开）：数据文件中每列参数对应的变量名，多个变量名之间使用英文“,”隔开。
- 忽略首行（只在设置了变量名称后才生效）：是否从第一行开始读取。
- 分隔符（用‘\t代替制表符’）：数据文件中的参数数据之间使用什么分隔符，此处就填写什么分隔符。
- 是否允许带引号？：如果选择“True”，数据文件中有引号，则变量引用后也带引号；如果选择“False”，无论数据文件中是否有引号，变量引用后都不带引号。
- 遇到文件结束符再次循环？：文件结束后是否从头开始读取数据，通常保持默认的True。
- 遇到文件结束符停止线程？：文件结束后是否停止线程，通常保持默认的False。
- 线程共享模式：读取的参数作用范围，通常选择“所有现场”，表示作用于全局。



本案例要求使用JMeter发送一个POST请求，请求地址为http://www.baidu.com。要求循环请求3次，每次携带username、password、code这3个参数，每次的参数值都不相同。

分析上述要求，循环请求3次，每次携带username、password、code这3个参数，每次的参数值都不相同，可以将3个参数数据写入CSV数据文件，通过添加CSV数据文件读取CSV数据文件实现参数化。

首先准备CSV数据文件，命名为data.csv，文件内容如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424155001614.png" alt="image-20250424155001614" style="zoom:67%;" />

准备好数据之后，按“ctrl+s”组合键保存。然后在JMeter中添加一个线程组，并在线程组中将循环次数设置为3，当设置完成后，在该线程组中添加一个CSV数据文件设置界面，该界面配置完信息后的效果如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424155230738.png" alt="image-20250424155230738" style="zoom:67%;" />

由上图可知，data.csv文件中的第一行就是数据，不能忽略首行。在读取文件时，设置了3个变量user1、pwd1、code1用于携带data.csv中的数据。

将线程组循环次数设置为3，在HTTP请求界面引用变量，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424155438360.png" alt="image-20250424155438360" style="zoom:67%;" />

配置完成后执行测试，测试结果如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424155532454.png" alt="image-20250424155532454" style="zoom:67%;" />

由上图可知，JMeter一共发送了3次请求，在请求的请求体中携带了username、password、code这3个参数。



#### 5.计数器

使用JMeter进行测试时，当需要引用大量的测试数据并要求测试数据能够自增且不能重复时，则可以使用计数器来实现。计数器设置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424171923196.png" alt="image-20250424171923196" style="zoom:67%;" />

计数器设置界面的主要配置项如下。

- Starting value：计数器的起始值。
- 递增：计数器递增的值。
- Maximum value：计数器的最大值。
- 数字格式：可选格式，例如设置为000，格式化后为001，002。
- 引用名称：用于设置变量名，引用的方式为${变量名}。
- 与每用户独立的跟踪计数器：每个线程都有自己的计数器。如果勾选该复选框，则用户1获取的值为1，用户2获取的值为2。如果不勾选该复选框，就表示全局计数器，则用户1获取的值为1，用户2获取的值也是1。
- 在每个线程组迭代上重置计数器：可选项，当勾选“与每用户独立的跟踪计数器”复选框时才可以使用。如果勾选了该复选框，则每次线程组迭代都会重置计数器的值。



下面通过一个案例演示计数器的使用。本案例要求使用JMeter发送一个POST请求，请求地址为http://www.baidu.com。要求发送请求时携带参数id,并循环请求6次，每次请求的递增值为1，其中最大值为5，数字格式为000。

分析上述要求可知，通过添加计数器可以实现每次请求的递增值为1。首先在JMeter中添加线程组，在线程组设置界面将循环次数设置为6，然后选中线程组并右键单击，在弹出的快捷菜单中依次选择“添加”->"配置元件"->"计数器"，计数器界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424172740687.png" alt="image-20250424172740687" style="zoom:67%;" />

当添加完计数器后，在线程组中添加一个HTTP请求，按照案例要求在HTTP请求界面中设置请求的参数，HTTP请求界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424173320376.png" alt="image-20250424173320376" style="zoom: 80%;" />

当设置完请求参数后，在线程组中添加一个察看结果树，保存之后执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424173400804.png" alt="image-20250424173400804" style="zoom:67%;" />

由上图可知，JMeter共发送了6次请求，当查看到第1~5个请求时，可以发现请求的参数值逐个递增，即在上图中所示界面的“POST data:”下方分别显示001、002、003、004、005。由于计数器设置了最大值为5，所以第6个请求的参数值不再递增。



### 5.4.4 断言

断言用于验证响应结果是否正确，即用一个预设的结果（如值、表达式、时间长短等）与实际结果进行匹配，匹配成功就是断言成功，匹配失败就是断言失败。JMeter常用的断言有相应断言、JSON断言、断言持续时间。



#### 1.响应断言

响应断言可以对任意格式的响应数据进行断言。如果想要在测试计划中使用响应断言的方式进行断言，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“断言”->“响应断言”，会添加一个响应断言界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424174514455.png" alt="image-20250424174514455" style="zoom:67%;" />

由上图可知，响应断言可以分为3个部分。

##### （1）测试字段

测试字段用于配置要断言的项。测试字段有多个，具体如下。

- 响应文本：响应主体。
- 响应代码：响应的状态码，例如200。
- 响应信息：响应的状态信息，例如OK。
- 响应头：响应的头部信息。
- 请求头：请求的头部信息。
- URL样本：请求的URL。
- 文档（文本）：响应的整个文档。
- 忽略状态：忽略返回的响应状态码。
- 请求数据：请求内容。

##### （2）模式匹配规则

模式匹配规则是对断言内容进行匹配的方式。模式匹配规则主要有以下几种。

- 包括：返回结果包含指定的内容，支持正则匹配。
- 匹配：预期结果与实际结果相等，支持正则匹配。
- 相等：预期结果与实际结果相等，不支持正则匹配。
- 字符串：与包括类似，但不支持正则匹配。
- 否：取反。如果断言结果为true，那么在选择“否”之后，最终断言结果为false。如果断言结果为false，那么在选择“否”之后，最终结果为 true。
- 或者：如果测试模式有多个，只要其中一个测试模式匹配，断言就会成功；如果没有选择“或者”，则多个测试模式必须都匹配成功，断言才会成功。



##### （3）测试模式

测试模式即填写的预期结果。单击下方的“添加”按钮，可以添加测试模式；单击“删除”按钮，可以删除测试模式。测试模式可以添加多个。



下面通过一个案例演示响应断言的使用。本案例要求使用JMeter发送一个GET请求，请求地址为http://www.baidu.com，检查响应数据中是否包含“**百度一下，你就知道**”字符串，测试字段选择“响应文本”，模式匹配规则选择“字符串”。



下面在JMeter中构建测试目录树，选中JMeter主界面的“HTTP请求”并右键单击，在弹出的快捷菜单中依次选择 “添加”-> "断言" -> "响应断言"，响应断言配置界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424175042061.png" alt="image-20250424175042061" style="zoom:80%;" />

HTTP请求配置比较简单，这里不再展示HTTP请求配置界面。配置完成之后，执行测试，会发现测试成功。若测试成功，查看结果树不会显示断言信息。如果想要查看断言信息，可以修改测试模式内容，例如，将“百度一下，你就知道”中的逗号改为英文状态下的逗号，再次执行测试，则会断言失败，断言失败页面如下。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250424175432964.png" alt="image-20250424175432964" style="zoom:80%;" />

由上图可知，断言失败，提示返回结果中不包含期望的“百度一下，你就知道”（英文逗号）。



#### 2.JSON断言

JSON断言用于对JSON格式的响应结果进行断言。如果想要在测试计划中添加JSON断言，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“断言”->“JSON断言”，会添加一个JSON断言界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425103501408.png" alt="image-20250425103501408" style="zoom:67%;" />

关于JSON断言的配置项介绍如下。

- Assert JSON Path exists：用于配置要断言的JSON元素的路径。
- Additionally assert value：是否要使用指定的值生成断言。
- Match as regular expression：使用正则表达式断言。
- Expected Value：期望值。如果勾选了“Additionally assert value”复选框，就在这里填写期望值。
- Expected null：如果期望的值为null，就勾选该复选框。
- Invert assertion（will fail if above conditions met）：反转断言。断言成功时，如果勾选该复选框，则断言失败。

下面通过一个案例演示**JSON断言**的使用。本案例要求使用JMeter发送一个GET请求，请求地址为http://www.weather.com.cn/data/sk/101010100.html，检查响应的JSON数据中，city对应的内容是否为“北京”，如下图所示。



分析上述要求，检查响应的JSON数据，需要添加JSON断言。首先在测试计划中添加一个线程组，在线程组中添加一个HTTP请求，HTTP请求配置界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425103722062.png" alt="image-20250425103722062" style="zoom: 80%;" />

在上图中，右键单击“HTTP请求”，在弹出的快捷菜单中依次选择“添加”->"断言"->“JSON断言”，会添加一个JSON断言配置界面，在该界面配置JSON断言，如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425103921803.png" alt="image-20250425103921803" style="zoom: 80%;" />

在上图所示界面中，JSON元素路径可以根据服务器返回的结果获取，断言的期望值为“北京”，在填写期望值之前，必须要勾选“Additionlly assert value”复选框。配置完成之后，执行测试，测试结果如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425104253211.png" alt="image-20250425104253211" style="zoom:67%;" />

由上图可知，响应数据中包含“北京”，JSON断言成功。



#### 3.断言持续时间

**断言持续时间主要用于断言请求的响应时间是否满足要求**。如果在测试计划中需要添加断言持续时间，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“**添加**”->“**断言**”->“**断言持续时间**”，会添加一个断言持续时间界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425104420981.png" alt="image-20250425104420981" style="zoom:67%;" />

上图中，“持续时间（毫秒）”配置项用于配置请求的最大响应时间，超过该时间，断言失败。

下面通过一个案例演示断言持续时间的使用。本案例要求使用JMeter发送一个GET请求，请求地址为https://www.jd.com，检查响应时间是否超过100毫秒。

分析上述要求，检查响应时间可以通过断言持续时间实现。构建测试计划目录树，添加HTTP请求、添加断言持续时间和查看结果树，并进行相应配置，HTTP请求的配置界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425104803807.png" alt="image-20250425104803807" style="zoom: 80%;" />

断言持续时间配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425104909084.png" alt="image-20250425104909084" style="zoom:80%;" />

配置完成后执行测试，测试结果如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425105050693.png" alt="image-20250425105050693" style="zoom:67%;" />

由上图可知，本次断言请求失败，失败原因是请求响应时间为153毫秒，超过了100毫秒。



### 5.4.5 前置处理器

前置处理器用于在请求发送之前对请求进行一些特殊的处理，例如参数化、加密请求和替换请求字段等。较为常用的元件是用户参数，用户参数可以保证不同的用户访问时，获取不同的参数值。

下面以用户参数为例，讲解前置处理器的使用。首先选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“前置处理器”->“用户参数”，会添加一个用户参数界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425105702914.png" alt="image-20250425105702914" style="zoom:67%;" />

在上图中，单击下方的“添加变量”，按钮可以增加输入栏，在输入栏中可以配置用户发送请求时需要的参数：单击下方的“添加用户”按钮可以增加用户。在请求中引用用户参数界面配置的变量，也可以实现用户数据化参数。

下面通过一个案例演示用户参数的使用。本案例要求使用JMeter发送一个GET请求，请求地址为https://www.baidu.com/S，第一个用户携带参数为：name=张三&age=28; 第二个用户携带参数为：name=李四&age=30。

分析上述要求可知，需要用两个用户发送请求，则线程组数量设置为2。案例要求不同的用户携带的参数不同，可以通过添加配置用户参数实现。明确了案例要求后，下面在JMeter中构建测试计划目录树，添加线程组、用户参数、HTTP请求、查看结果树，并进行相应配置。用户参数配置页面如下。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425110321116.png" alt="image-20250425110321116" style="zoom:80%;" />

用户参数配置完成之后，配置HTTP请求，HTTP请求配置界面如下图。

![image-20250425110509205](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425110509205.png)

配置完HTTP请求之后执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425110427373.png" alt="image-20250425110427373" style="zoom:67%;" />

### 5.4.6 后置处理器

后置处理器用于对响应数据进行关联处理，所谓关联就是请求之间有依赖关系，例如一个请求需要另一个请求的响应数据作为参数，则需要先获取另一个请求的响应数据，对其进行处理，再将响应数据作为参数来发送请求。获取一个请求的响应数据就需要用到后置处理器。

JMeter中常用的后置处理器有正则表达式提取器、Xpath提取器、JSON提取器。

#### 1.正则表达式提取器

##### （1）正则表达式

正则表达式表是一种文本模式，它可以使用普通字符和特殊字符（元字符）描述一个字符串规则，用于匹配一系列符合该规则的字符串。正则表达式通常用来检索、替换符合特定规则的字符串。例如，“a.”中的元字符“.”表示任意字符，则“a.”可以匹配“aa”“ab”“ac”“a1”等任何满足包含两个字符且第1个字符是a的字符串。



正则表达式的元字符有很多，常用的正则表达式元字符如下表所示。

| **元字符** | **含义**                                           |
| ---------- | -------------------------------------------------- |
| ()         | 封装待返回的字符串                                 |
| .          | 匹配除换行符以外的任意字符                         |
| +          | 匹配前面的字符串一次或多次                         |
| ?          | 匹配前面的字符串0次、1次，在找到第一个匹配项后停止 |
| *          | 匹配前面出现的字符0次或多次                        |
| ^          | 匹配字符串的开始位置                               |
| $          | 匹配字符串的结束位置                               |
| \|         | 模式选择符，从中任选一个匹配                       |

JMeter中的正则表达式匹配格式如下。

~~~properties
左边界(正则表达式)右边界
~~~

在上述格式中，()中的内容是正则表达式，它所匹配的结果就是要获取的字符串。例如，请求百度首页，返回数据片段如下。

~~~html
<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html;charset=gb2312"><title>百度一下，你就知道      </title><style>html{overflow-y:auto}body{font:12px arial;
~~~

如果要从返回数据片段中提取“百度一下，你就知道”，则在设置正则表达式时，需要先找出左、右边界，左边界为'<'title'>'，右边界为'<'/title'>'，在()中设置正则表达式为“.*”，完整正则表达式如下。

~~~html
<title>(.*)</title>
~~~

通过上述表达式就可以匹配出字符串“百度一下，你就知道”。上述正则表达式能够匹配出所有的“百度一下，你就知道”，当它搜索到满足条件的字符时，不会停止，会继续往后匹配，直到数据结束，这种匹配模式称为“贪婪”模式。

如果只想匹配一次，可以在“.*”后面添加“?”，具体如下。

~~~html
<title>(.*?)</title>
~~~

添加了“?”之后，正则表达式就只会匹配一次，一旦搜索到匹配的字符串就会结束搜索，这种匹配模式称为“懒惰”模式。



##### （2）配置正则表达式提取器

JMeter中的正则表达式提取器是支持正则表达式匹配来提取任意格式的响应数据的元件。如果在测试计划中需要配置正则表达式提取器，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“后置处理器”->“正则表达式提取器”，会添加一个正则表达式提取器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425112123999.png" alt="image-20250425112123999" style="zoom:67%;" />

 由上图可知，正则表达式提取器的主要配置项有以下5个。

- 引用名称：用于存储正则表达式提取出的值，以供其他请求引用，引用方式为${引用名称}。
- 正则表达式：为提取数据设置的正则表达式。
- 模板：用于设置使用提取到的第几个值。如果正则表达式有多个()，就可以提取出多组值，这里可以指定要使用的级别，格式为$n$，例如$1$表示使用第1组数据；$2$、$3$表示使用第2、3组数据。如果n的值为0（$0$），表示使用全部数据。
- 匹配数字（0代表随机）：表示取一组数据中的第几个值。0表示随机取值，-1表示取全部值，其他正整数n表示取第n个值。
- 缺省值：默认值，如果引用名称没有取到值，就使用该默认值。

下面通过一个案例演示正则表达式提取器的使用。本案例要求使用JMeter发送两个请求，具体要求如下。

- 请求一：请求地址为https://www.itcast.cn，获取网页的‘<’title‘>’标签的值。
- 请求二：请求地址为https://www.baidu.com/S，把请求一的‘<’title‘>’标签的值作为请求参数。

分析上述要求可知，请求一和请求二具有关联关系，可以使用正则表达式提取器提取请求一中的数据，再将其作为请求二的参数。首先构建测试计划目录树，然后进行相应配置，如下图所示

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425112423967.png" alt="image-20250425112423967" style="zoom:67%;" />

测试计划目录树构建完成后，进行相应配置，其中正则表达式提取器配置界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425112602794.png" alt="image-20250425112602794" style="zoom:67%;" />

在上图中，正则表达式设置为‘<‘title>(.*?)<’/title>’，表示只取一次匹配数据，`$1$`表示取其中第1组数据，匹配数字表示取第1组数据中的第1个值。

正则表达式中的引用名称r_title在HTTP请求-百度的请求界面中被引用，配置界面和测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425112908724.png" alt="image-20250425112908724" style="zoom: 80%;" />

在上图找那个，引用变量可以在路径中引用，也可以在参数列表中引用。配置完成后，执行测试，测试结果如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425113027568.png" alt="image-20250425113027568" style="zoom:80%;" />

由上图可知，请求一和请求二发送成功，并且请求二成功把请求一获取到的‘<‘title>标签作为请求参数。

#### 2.XPath提取器

XPath提取器用于提取HTML格式的响应数据，它通过HTML文档中的标签来提取数据。如果在测试计划中需要使用XPath提取器，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“后置处理器”->“XPath提取器”，会添加一个Xpath提取器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425113401599.png" alt="image-20250425113401599" style="zoom:67%;" />

XPath提取器的常用配置项如下。

- Use Tidy(tolerant parser)：如果需要处理的页面是HTML格式的，则必须勾选该复选框；如果需要处理的页面是XML或XHTML格式的，则取消该复选框的勾选。
- 引用名称：存储提取出的值。
- XPath query：XPath表达式，即要提取哪些节点元素。
- 匹配数字（0代表随机）：选择提取结果。0表示随机取值，-1表示取全部值，其他正整数n表示取第n个值。
- 缺省值：默认值，如果引用名称没有取到值，则使用该默认值。

下面通过一个案例演示XPath提取器的使用。以前面正则表达式提取器中的案例为例，同样发送两个请求，要求使用XPath提取器提取请求一中的title值。将正则表达式提取器替换为XPath提取器。XPath提取器配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425113534577.png" alt="image-20250425113534577" style="zoom:80%;" />

配置完XPath提取器之后，执行测试，测试结果如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425113634393.png" alt="image-20250425113634393" style="zoom:80%;" />

由上图可知，当使用XPath提取器时，请求一和请求二发送成功，并且请求二也能够成功把请求一的`<title`标签作为请求参数。



#### 多学一招

XPath语言（XML Path Language，XML路径语言）是一种用来确定XML文档中某部分位置的语言。XPath提供了一套语法规则，可以帮助用户快速选取XML/HTML文档中的目标节点。

##### （1）选取节点

选取节点是最基础的操作，节点所在的路径既可以是从根节点开始的，也可以是从任意位置开始的。选取节点的方法如下表所示。

| **表达式** | **说明**                               |
| ---------- | -------------------------------------- |
| 节点名称   | 选取此节点的所有子节点                 |
| /          | 从根节点选取直接子节点，相当于绝对路径 |
| //         | 从当前节点选取子孙节点，相当于相对路径 |
| .          | 选取当前节点                           |
| ..         | 选取当前节点的父节点                   |
| @          | 选取属性节点                           |

下面以一个XML文档bookstore.xml为例演示如何使用表中的表达式选取XML文档中的节点。bookstore.xml的具体内容如下。

~~~xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<bookstore>
    <book>
        <title lang="eng">Harry Potter</title>
        <price>29.99</price>
    </book>
    <book>
        <title lang="eng">Learning XML</title>
        <price>39.95</price>
    </book>
</bookstore>	
~~~

选取节点的示例代码如下。

~~~properties
bookstore              # 选取bookstore的所有子节点
/bookstore            # 选取根节点bookstore
bookstore/book    # 从根节点bookstore开始，向下选取名为book的所有子节点
//book                   # 从任意节点开始，选取名为book的所有子节点
bookstore//book   # 从bookstore的后代节点中，选取名为book的所有子节点
//@lang                 # 选取所有名为lang的属性节点	
~~~

##### （2）谓语

谓语是选取节点时的附加条件，主要用于对节点集进行筛选，选取出某个特定的节点，或者包含指定属性或基本值的节点。谓语会嵌入到中括号中，并位于要补充说明的节点后面。带谓语的路径表达式的基本格式如下。

~~~properties
     节点[谓语]
~~~

中括号中的谓语可以是整数、属性、函数，也可以是整数、属性、函数与运算符组合的表达式。若为整数（从1开始），则这个数值将作为位置，用于从节点集中选取与该位置对应的节点；若为属性，则会从节点集中选取包含该属性的节点；若为函数，则会将该函数的返回值作为条件，从节点集中选取满足条件的节点。



常用的XPath函数如下表所示。

| **函数**                  | **说明**                                        |
| ------------------------- | ----------------------------------------------- |
| position()                | 返回当前被处理的节点的位置                      |
| last()                    | 返回当前节点集中的最后一个节点                  |
| count()                   | 返回节点的总数目                                |
| max((arg,arg,...))        | 返回大于其他参数的参数                          |
| min((arg,arg,...))        | 返回小于其他参数的参数                          |
| name()                    | 返回当前节点的名称                              |
| current-date()            | 返回当前的日期（带有时区）                      |
| current-time()            | 返回当前的时间（带有时区）                      |
| contains(string1,string2) | 若string1包含string2，则返回true，否则返回false |

下面以bookstore.xml为例演示带谓语的路径表达式的用法，具体代码如下。

~~~properties
/bookstore/book[1]                     # 选取属于bookstore子节点的第1个book节点
/bookstore/book[last()]               # 选取属于bookstore子节点的最后一个book节点
/bookstore/book[last()-1]            # 选取属于bookstore子节点的倒数第2个book节点
/bookstore/book[position()<3]   # 选取属于bookstore子节点的前2个book节点
//title[@lang]                              # 选取所有的属性名称为lang的title节点
//title[@lang= 'eng']                   # 选取所有的属性名称为lang且属性值为eng的title节点
# 选取子节点price的值大于35.00，且父节点为bookstore的所有book节点
/bookstore/book[price>35.00]
# 选取属于book的所有子节点title，且节点book的子节点price的值必须大于35.00
/bookstore/book[price>35.00]/title
~~~

#### 3.JSON提取器

JSON提取器用于提取JSON格式的响应数据，如果在测试计划中需要使用JSON提取器，则可以选中JMeter主界面的测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“后置处理器”->“JSON提取器”，会添加一个JSON提取器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425114114462.png" alt="image-20250425114114462" style="zoom: 50%;" />

 JSON提取器的常用配置项如下。

- Names of created variables：引用名称，存储提取出的数据。
- JSON Path expressions：JSON路径表达式，即提取路径。
- Match No. (0 for Random)：匹配数字，0表示随机取值，-1表示取全部值，其他正整数n表示取第n个值。
- Default Values：默认值，如果引用名称没有取到值，就使用该默认值。

下面通过一个案例演示JSON提取器的使用。本案例要求使用JMeter发送两个请求，具体如下。

请求一：请求地址为http://www.weather.com.cn/data/sk/101010100.html，获取返回结果中的城市名称“北京”。
请求二：请求地址为https://www.baidu.com/S?wd=北京，把请求一返回的城市名称“北京”作为请求参数。



分析上述案例要求，首先在JMeter中添加并配置第一个HTTP请求，请求一的HTTP请求界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425114355233.png" alt="image-20250425114355233" style="zoom: 80%;" />

然后在JMeter中添加察看结果树并执行测试，请求一的测试结果界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425114512401.png" alt="image-20250425114512401" style="zoom:80%;" />

由上图可知，请求一种的天气服务器返回结果的格式为JSON格式，可以添加JSON提取器提取需要的数据。JSON提取器配置界面如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425114735376.png" alt="image-20250425114735376" style="zoom: 80%;" />

JSON提取器配置完成之后，在JMeter中添加第二个HTTP请求，并按照案例要求在请求二的HTTP请求界面中引用city，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425114825874.png" alt="image-20250425114825874" style="zoom: 80%;" />

第二个HTTP请求配置完成之后，执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425114925835.png" alt="image-20250425114925835" style="zoom: 50%;" />

由上图可知，请求二成功把请求一返回的城市名称“北京”作为请求参数。





### 5.4.7 逻辑控制器

逻辑控制器用于控制脚本的执行顺序。在JMeter中有17个逻辑控制器元件，它们可以分为两类。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425115210579.png" alt="image-20250425115210579" style="zoom: 67%;" />

一类是控制测试计划节点发送请求的逻辑顺序控制器，包括如果（If）控制器、循环控制器等。另一类是用来对测试计划中的脚本进行分组，方便JMeter统计执行结果以及进行脚本的运行时控制等，包括事务控制器、吞吐量控制器等。由于本章只是关于JMeter的入门学习，所以只讲解控制发送请求的逻辑顺序控制器。常用的逻辑顺序控制器有如果（if）控制器、循环控制器、ForEach控制器。



#### 1.如果（If）控制器

如果（If）控制器用于控制测试请求是否执行（如果条件成立时执行，条件不成立时不执行）。如果在线程组中需要使用如果（If）控制器，则首先在JMeter主界面的测试计划中添加一个线程组，然后选中线程组并右键单击，在弹出的快捷菜单中依次选择“添加”->“逻辑控制器”->“如果（If）控制器”，会添加一个如果（If）控制器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425115540760.png" alt="image-20250425115540760" style="zoom:67%;" />

在上图中，在“条件”配置项后面的输入框中填写条件表达式，条件表达式遵循JavaScript语法，例如`${city}=="北京"`。

除了按照JavaScript语法设置条件表达式外，还可以将条件解释为变量表达式。在上图中，勾选“Interpret Condition as Variable Expression?”复选框，表示将条件解释为变量表达式。勾选该复选框之后，如果（If）控制器界面会发生变化，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250425120454884.png" alt="image-20250425120454884" style="zoom:67%;" />

输入框中的条件表达式不会再按照JavaScript 语法进行解析，而是被视为 JMeter 的变量表达式。输入框中不能直接填写条件表达式，而是输入使用__jexl3()或者 groovy()函数生成的函数表达式。



由于将条件解释为变量表达式，不需要再按照JavaScript语法解释条件表达式，所以它具有更高的执行效率，在实际测试中的应用也更多。



为了让大家更好地掌握如果（If）控制器，下面通过一个案例演示如果（If）控制器的使用。本案例要求使用用户定义的变量定义一个变量name，name有两个可选值：baidu和itcast。如果name的值为baidu，则请求https://www.baidu.com；如果name的值为itcast，则请求https://www.itcast.cn。

分析上述要求，根据 name 的值判断发送哪个请求，需要使用如果（If） 控制器实现。确定了核心元件之后，构建测试计划目录树，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250427152623021.png" alt="image-20250427152623021" style="zoom:67%;" />

在用户定义的变量界面中定义变量name，假设初始值为百度。由于用户定义的变量、HTTP请求配置都比较简单，所以本案例不再展示它们的配置。



为了让大家掌握如果（If）控制器的两种配置方式，本案例分别以不同方式配置 **如果（If）控制器-百度**和**如果（If）控制器-itcast**两个元件。

首先配置如果（If）控制器-百度，**不勾选“Interpret Condition as Variable Expression?”复选框**，直接在输入框中输入条件表达式，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250427154057710.png" alt="image-20250427154057710" style="zoom:67%;" />

然后配置如果（If）控制器-itcast，勾选“Interpret Condition as Variable Expression?” 复选框，需要通过函数生成变量表达式。

在JMeter工具栏单击“函数助手”按钮（![image-20250428083453689](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428083453689.png)），弹出“函数助手”对话框，如下图。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428083603701.png" alt="image-20250428083603701" style="zoom:67%;" />

在上图中，首先单击顶部的下拉列表框右侧的下拉按钮，选择“**jexl3**”，在jexl3的函数参数列表中输入条件表达式“**${name}”==“itcast”**之后，单击“生成”按钮生成函数表达式，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428083710417.png" alt="image-20250428083710417" style="zoom:67%;" />

由上图可知，**jexl3**生成了一个函数表达式，再次单击“生成”按钮可以复制生成的“${__jexl3(“${name}”==“itcast”,)}”表达式。当复制成功之后，关闭“函数助手”对话框，将生成的函数表达式粘贴到如果（If）控制器-itcast元件的输入框中，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428084135005.png" alt="image-20250428084135005" style="zoom:67%;" />

当配置完成之后，执行测试，可以发现发送的请求为 https://www.baidu.com，这是因为此时 name 的值为baidu。如果将 name 的值修改为 itcast，再次执行测试，则发送的请求就是 https://www.itcast.cn。



#### 2.循环控制器

循环控制器可以通过设置循环次数，实现循环发送请求。如果在线程组中需要使用循环控制器，则首先选中JMeter主界面的线程组并右键单击，在弹出的快捷菜单中依次选择“添加”->“逻辑控制器”->“循环控制器”，会添加一个循环控制器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428084329949.png" alt="image-20250428084329949" style="zoom:80%;" />

由上图可知，循环控制器只有一个配置项，该配置项用于设置请求的循环次数。循环控制器的循环次数与线程组的循环次数相同，只是两者的作用域不同，线程组中的循环次数可以控制线程组内的所有请求，而循环控制器的循环次数只能控制其下层的请求。假如有一个测试计划，其目录树结构如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428084729515.png" alt="image-20250428084729515" style="zoom:80%;" />

如果线程组循环次数设置为3，循环控制器的循环次数设置为4，则HTTP请求-1的循环次数为12（即3*4），HTTP请求-2的循环次数为3。线程组可以控制HTTP请求-1和HTTP请求-2，而循环控制器只能控制HTTP请求-1。



#### 3.ForEach控制器

**ForEach控制器可以遍历读取一组数据，控制其下层的取样器执行的次数。**ForEach控制器通过与用户定义的变量、正则表达式提取器结合使用，可以从用户定义的变量或者从正则表达式提取器的返回结果中读取一系列数据。



如果在线程组中需要使用**ForEach控制器**，则首先选中JMeter主界面中的线程组并右键单击，在弹出的快捷菜单中依次选择“添加”->“逻辑控制器”->“ForEach控制器”，会添加一个ForEach控制器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428084928253.png" alt="image-20250428084928253" style="zoom: 80%;" />

ForEach控制器常用配置项如下。

- 输入变量前缀：将要遍历的一组数据的前缀。例如，id1、id2、id3这一组数据的前缀就是id。
- 开始循环字段（不包含）：循环起始位置，不读取当前位置的数据。例如，填写0，从第1个位置开始读取；填写1，从第2个位置开始读取。
- 结束循环字段（含）：循环结束的位置。
- 输出变量名称：用于保存读取的数据，在请求中可以引用该名称。



下面通过一个案例演示**ForEach控制器**的使用。本案例要求使用用户定义的变量定义一组关键字：**hello、pyhton、测试**。依次取出这一组关键字，将其作为请求参数请求百度网站（https://www.baidu.com/S?wd=hello）。

分析上述要求，要想逐个读取用户定义的变量并定义一组关键字作为请求参数，可以使用 ForEach 控制器。确定了核心元件之后，构建测试计划目录树，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428085158477.png" alt="image-20250428085158477" style="zoom:80%;" />

在上图界面所示用户定义的变量界面中定义一组关键字，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428085338168.png" alt="image-20250428085338168" style="zoom:80%;" />

定义好关键字之后，配置**ForEach控制器**和**HTTP请求界面**，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428085439764.png" alt="image-20250428085439764" style="zoom:67%;" />

在上图中，因为要逐个读取3个关键字，所以ForEach控制器的起始位置和结束位置分别是0和3。需要注意的是，取消勾选“数字之前加上下划线_？”复选框，因为上述案例中定义的关键字名称为name1，name2，name3，前缀name与数字之间没有下划线。如果关键字名称定义为name_1、name_2、name_3，就需要勾选此复选框。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428091534842.png" alt="image-20250428091534842" style="zoom:80%;" />

配置完成之后，执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428091622701.png" alt="image-20250428091622701" style="zoom: 67%;" />

由上图可知，本次测试共发送了3个请求，第一个请求参数为hello，后续两个请求参数为python、测试，说明用户定义的3个关键字全部读取成功。



### 5.4.8 定时器

**定时器用于为请求设置等待时间，使请求暂停一段时间再发送**。定时器的作用范围比较广，如果只想要定时器**针对某个请求**，则需要将定时器添加为**请求的子节点**。否则，定时器会控制与它同层的所有请求。JMeter中常用的定时器有**同步定时器、常数吞吐量定时器、固定定时器。**

#### 1.同步定时器

**同步定时器**（Synchronizing Timer）可以**阻塞线程**，当线程在规定时间内达到一定数量时，这些线程会在**同一个时间点一起发送请求**。同步定时器通常用于**压力测试、并发测试**等场景。例如，在模拟电商购物网站的抢购、秒杀活动时，通常会用到同步定时器。

如果在测试计划中需要使用同步定时器，则可以在JMeter主界面选中测试计划并右键单击，在弹出的快捷菜单中依次选择**“添加”->“定时器”->“Bean Shell Timer”**，会添加一个同步定时器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428092727250.png" alt="image-20250428092727250" style="zoom:80%;" />

由上图可知，同步定时器有两个常用配置项，具体介绍如下。

- 模拟用户组的数量：用于设置同步的线程数量。若设置为0，则以线程组中的线程数量为准。需要注意的是，模拟用户组的数量不能大于它所在的线程组的线程数量。
- 超时时间以毫秒为单位：用于设置超时时间。如果超时时间设置为0，则必须等线程数量达到所设置的数量时，才会发送请求；如果设置一个大于0的数值，则到了设置时间，即便线程数量没有达到要求，也会发送请求。



下面通过一个案例演示**同步定时器**的使用。本案例要求使用JMeter**模拟100个用户**同时访问百度首页（https://www.baidu.com），统计各种**高并发**情况下的运行情况。

分析上述要求，当模拟 100 个用户同时访问百度首页时，可以使用**同步定时器**实现。确定了核心元件之后，构建测试计划目录树，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428095022017.png" alt="image-20250428095022017" style="zoom:67%;" />

由于案例要求模拟100个用户并发，使用查看结果树显示的报告不易阅读，所以可以使用聚合报告显示结果报告。

目录树构建完成之后，进行各个元件的配置。线程组的配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428100011716.png" alt="image-20250428100011716" style="zoom:67%;" />

在上图中，将线程数设置为100，为了更好地观察测试结果，将Ramp-Up时间设置为10，勾选“永远”复选框。

HTTP请求的各项配置比较简单，本案例不再展示。配置**同步定时器**时，为了更好地观察测试的执行过程，可以先将同步定时器的**模拟用户组的数量设置为20，超时时间设置为0**。其配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428100337975.png" alt="image-20250428100337975" style="zoom:80%;" />

配置完成之后，执行测试，聚合报告的瞬间截图如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428100450259.png" alt="image-20250428100450259" style="zoom:67%;" />

上图中的样本数据（请求数量）每次增加20个，同步定时器设置的模拟用户组的数量为20,且没有设置超时时间，JMeter会等待请求数量达到20时一同发送。

在同步定时器的配置界面（上上图）中，将同步定时器的模拟用户组的数量设置为30，则再次执行测试，会发现聚合报告中样本数量到90时不再发送请求。这个因为发送90个请求以后，只剩下10个请求，无法再凑够30个请求一同发送，并且同步定时器没有设置超时时间，JMeter会一直等待。要应对这种僵持情况，可以在同步定时器的配置界面（上上图）中同时设置超时时间，当时间到达时，即便请求数量没有30个，JMeter也会发送请求。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428101118561.png" alt="image-20250428101118561" style="zoom:67%;" />

#### 2.常数吞吐量定时器

**常数吞吐量定时器**（Constant Throughput Timer）主要用于**设置QPS限制**，它可以让JMeter**按照指定吞吐量发送请求**。常数吞吐量定时器多用于**稳定性测试和混合压测**过程中同时压测多个接口以测试系统的稳定性。

如果在测试计划中需要使用**常数吞吐量定时器**，则可以在JMeter主界面选中测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“定时器”->“Constant Throughput Timer”，会添加一个常数吞吐量定时器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428101507727.png" alt="image-20250428101507727" style="zoom:80%;" />

由上图可知，常数吞吐量定时器的配置项较少，常用的配置项为目标吞吐量，它用于设置单个用户每分钟的吞吐量。假如要求模拟的业务场景QPS为20，即服务器每秒处理的请求数为20,则服务器每分钟只能处理1200个请求。如果线程数为1，则目标吞吐量为1200（即20x60）；如果线程数为2，则目标吞吐量为600（即20x60/2），即每个用户每分钟只能发送600个请求。



为了让读者更好地掌握常数吞吐量定时器，下面通过一个案例演示常数吞吐量定时器的使用。本案例要求使用JMeter发送请求访问百度首页（https://www.baidu.com）,QPS为20，持续运行一段时间，观察、统计运行时的性能指标变化。

分析上述要求，模拟的业务场景中 QPS 为 20，指定了吞吐量，可以使用常数吞吐量定时器实现吞吐量的设置。首先在 JMeter 中添加一个线程组，并在线程组界面勾选“永远”复选框，然后在该线程组中添加HTTP 请求，按照案例要求在HTTP请求界面完成相关配置，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428102034638.png" alt="image-20250428102034638" style="zoom:80%;" />

配置完成后，在HTTP请求下添加常数吞吐量定时器，常数吞吐量定时器的配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428102201640.png" alt="image-20250428102201640" style="zoom:80%;" />

在上图界面中，设置目标吞吐量为1200.。配置完成后按“Ctrl+S”组合键保存，在线程组中添加一个聚合报告并执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428102312211.png" alt="image-20250428102312211" style="zoom:80%;" />

由上图可知，测试运行时的吞吐量为20.1/sec，符合测试需求，本次测试的其他性能指标可以暂时不关注。需要注意的是，吞吐量并不是精确的20.0/sec，这是因为JMeter自身存在误差。

常数吞吐量定时器只有在线程组中的线程产生足够多请求时才有意义。有时候，即便设置了常数吞吐量定时器的值，也可能由于线程组中的线程数量不够，或定时器设置不合理等因素导致总体的QPS不能达到预期目标。



#### 3.固定定时器

固定定时器（Fixed Timer）可以使请求延迟指定时间发送。如果在测试计划中需要使用固定定时器，则可以在JMeter主界面选中测试计划并右键单击，在弹出的快捷菜单中依次选择“添加”->“定时器”->“固定定时器”，会添加一个固定定时器界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428103841605.png" alt="image-20250428103841605" style="zoom:80%;" />

由上图可知，固定定时器常用配置项只有一个“线程延迟（毫秒）”，它用于设置线程发送请求的延迟时间。固定定时器的使用也比较简单，下面通过一个案例演示**固定定时器**的使用。本案例要求**使用JMeter模拟登录iHRM人力资源管理系统**，具体登录情况如下。

- 请求地址：http://ihrm-java.itheima.net/api/sys/login。
- 请求方式：POST。
- 请求头：Content-Type:application/json;charset=UTF-8。
- 请求体：{"mobile":"13800000002","password":"123456"}。

当模拟用户登录时，登录出现3次输入错误后，锁定1分钟，等待1分钟后重新输入正确的用户名和密码，登录成功。

分析上述要求，除了添加基本的 HTTP 请求外，由于发送请求时有请求头信息，所以需要添加 HTTP 信息头管理器。本案例共发送 4 次请求，前 3次使用错误的用户名或密码登录失败，第 4 次等待 1 分钟后再使用正确的用户名和密码登录，则在第 4 次 HTTP 请求中需要添加固定定时器。按照案例要求，首先构建测试计划目录树，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428104544917.png" alt="image-20250428104544917" style="zoom:67%;" />

HTTP信息头管理器配置界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428104614352.png" alt="image-20250428104614352" style="zoom:67%;" />

HTTP请求-1的配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428104718194.png" alt="image-20250428104718194" style="zoom:80%;" />

固定定时器的配置界面如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428104750864.png" alt="image-20250428104750864" style="zoom:80%;" />

配置完成之后，执行测试，测试结果如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428105143736.png" alt="image-20250428105143736" style="zoom:80%;" />

由上图可知，按照HTTP请求-1配置HTTP请求-2、HTTP请求-3、HTTP请求-4，注意**HTTP请求-4的用户名和密码必须是正确的**。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428105220865.png" alt="image-20250428105220865" style="zoom:80%;" />

由上图可知，HTTP请求-4的响应数据为“操作成功”。



## 5.5 实例：轻商城项目性能测试

为了让大家能够掌握前面讲解的性能测试的基础知识，本节将通过轻商城项目来演示如何使用JMeter对该项目的核心业务功能进行性能测试。



### 5.5.1 项目简介

**轻商城**是一个目前比较流行的**电商购物项目**，该项目包含登录、首页、商品、购物车、订单等模块。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428105717504.png" alt="image-20250428105717504" style="zoom:67%;" />

登录模块用于为用户提供个人账号、密码等信息的输入功能，当用户成功登录时，能够浏览、查看和购买所需商品。

首页模块主要用于展示热销、活动或折扣的商品。

商业模块用于为用户提供搜索商品的功能，当用户搜索到所需商品后，可以查看商品的详情。

购物车模块用于为用户提供添加购物车和查看购物车的功能。

订单模块用于为用户提供商品结算、提交订单和查看订单的功能。



**登录、首页、商品、购物车、订单**等模块是轻商城项目为用户提供的**核心业务功能**。在开展大型的购物活动期间，例如“双十一”购物节，店铺为了吸引更多的用户进行购物消费，通常会推出新品并以折扣的方式在某个时间段出售，在此期间，用户会依据这些功能进行频繁的操作（如同时登录、查看或加购商品），**极易导致电商购物项目崩溃**。

因此，为了能够综合评估项目核心业务功能的性能，并结合项目性能测试的情况进行性能分析与调优，满足项目上线的性能需求，需要对项目进行性能测试。



### 5.5.2 项目部署

为了能够访问轻商城，需要部署轻商城项目环境。在部署该环境时，可以使用自己的计算机作为服务器，但为了不影响计算机的日常使用，可以在虚拟机环境下搭建轻商城服务器。虚拟机软件可在物理主机的系统中虚拟出多个计算机设备，每台设备都可以安装独立的操作系统，实现在一台物理机上同时运行多个系统。



在项目部署的过程中，难免会遇到各种问题和挑战，这时我们可以试着换个方法或角度去思考，不断尝试，充分发挥自身的潜力，冷静地分析问题，最终顺利解决问题。



确定了基础环境之后，下面介绍具体的环境部署步骤，可扫描二维码进行查看。

~~~properties
项目环境部署步骤：https://ewm.proedu.com.cn/previewPdf/1183164
~~~

#### 1.安装VMware虚拟机

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111026589.png" alt="image-20250428111026589" style="zoom: 80%;" />

#### 2.搭建轻商城

##### （1）打开轻商城虚拟机

解压轻商城镜像文件压缩包，注意，解压目录不能含有中文。轻商城镜像文件压缩包解压完成之后，打开VMware Workstation 15并单击“打开虚拟机”选项，选择轻商城镜像文件，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111250199.png" alt="image-20250428111250199" style="zoom:67%;" />

选择轻商城镜像文件之后，单击“打开”按钮，VMware Workstation 15就会加载轻商城虚拟机，单击“开启此虚拟机”，进入登录界面，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111335374.png" alt="image-20250428111335374" style="zoom: 50%;" />

在登录界面中单击“未列出?”选项，首先输入用户名（root）和密码（123456），然后单击“登录”按钮完成登录，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111413529.png" alt="image-20250428111413529" style="zoom:67%;" />

##### （2）测试轻商城虚拟机网络

打开轻商城虚拟机之后，在虚拟机桌面的任意空白位置处右键单击，会弹出一个快捷菜单，单击该快捷菜单中的 “打开终端”选项，会打开虚拟机的终端窗口，在该窗口中可以输入” “ifconfig”命令查看轻商城虚拟机的IP地址，如下图所示。

![image-20250428111454526](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111454526.png)

需要注意的是，每个机器安装的轻商城的IP地址都不相同。在Windows系统中打开命令提示符窗口，使用“ping”命令测试轻商城虚拟机的网络是否处于连接状态，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111525374.png" alt="image-20250428111525374" style="zoom:67%;" />

##### （3）修改hosts配置文件

在Windows系统中，找到C:\Windows\System32\drivers\etc目录下的hosts配置文件，选中hosts配置文件，右键单击选择属性选项，会弹出hosts属性对话框，去掉 “只读”属性左侧的勾选，单击“确定”按钮，此时hosts文件中的内容处于可编辑的状态。打开hosts文件，在该文件的末尾添加轻商城虚拟机的IP地址和轻商城的域名，如下图所示。

![image-20250428111616455](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428111616455.png)



### 5.5.3 搭建测试环境

由于轻商城项目部署在虚拟机中，在进行性能测试时，除了要监控响应时间、吞吐量等指标外，还需要监控项目的服务器资源使用率，例如CPU、内存、磁盘的使用率等。所以在性能测试监控之前需要搭建测试环境。包括下载与安装finalshell、下载SeverAgent服务器、jemeter-plugins-manager插件和构造测试数据。

确定了测试环境之后，下面介绍搭建测试环境的具体操作步骤，具体内容可扫描下方二维码进行查看。

~~~properties
搭建测试环境的具体步操作骤：https://ewm.proedu.com.cn/previewPdf/1183165
~~~

#### 1.下载与安装FinalShell

FinalShell主要用于连接虚拟机，通过FinalShell可以实时监控虚拟机的CPU、内存等使用情况。在FinalShell官方网站中即可下载FinalShell。

![image-20250428112230651](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428112230651.png)





![image-20250428112306269](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428112306269.png)

#### 2.下载ServerAgent服务器

由于需要监控性能测试过程中的服务器资源使用率，所以需要下载ServerAgent服务器，它既可以监控Windows系统的服务器资源使用率，也可以监控Linux系统的服务器资源使用率。在GitHub官方网站中可以直接下载ServerAgent，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428112427669.png" alt="image-20250428112427669" style="zoom:67%;" />

#### 3.下载jmeter-plugins-manager插件

在JMeter工具中通过添加**jp@gc - PerfMon Metrics Collector**监听器监控服务器的资源使用情况，由于jp@gc - PerfMon Metrics Collector是JMeter的第三方插件，所以需要到JMeter插件的官方网站中下载，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428112512234.png" alt="image-20250428112512234" style="zoom:67%;" />

当下载成功后得到一个**jmeter-plugins-manager-1.7.jar**文件，需要将该文件复制到JMeter解压后的**lib目录的ext文件夹**中。当重新启动JMeter时，单击菜单栏中的“选项”，会发现列表选项增加了一个Plugins Manager，单击该选项会打开JMeter Plugins Manager对话框，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428112602360.png" alt="image-20250428112602360" style="zoom:67%;" />

如果在下载jmeter-plugins-manager插件的过程中，出现json-lib下载失败的问题，该问题的解决办法是在JMeter的jmeter.properties文件中添加如下配置。

~~~xml
<dependency>  
    <groupId>net.sf.json-lib</groupId>  
    <artifactId>json-lib</artifactId>  
    <classifier>jdk15</classifier> 
 </dependency>  
~~~

#### 4.构造测试数据

为了快速构建大量数据，可以在PyCharm中编写Python代码直接操作数据库进行添加。

首先构造用户数据和地址数据，具体实现代码如下。

~~~python
# 导包 
import pymysql  
# 创建连接 
conn = pymysql.connect(host="192.168.208.128",user="root",  
                       password="123456",database="litemall",  
                       port=3306,charset='utf8')  
# 创建游标 
cursor = conn.cursor()  
# 添加用户的SQL语句 
user_sql = "INSERT INTO 'litemall'.'litemall_user' ('id', " \
"'username', 'password', 'gender', 'birthday', "
"'last_login_time', 'last_login_ip', 'user_level', " \ 
"'nickname','mobile', 'avatar', 'weixin_openid', " \ 
"'session_key', 'status', 'add_time', 'update_time', " \ 
"'deleted') VALUES ({}, 'user{}', " \
"'$2a$10$lTu9qi0hr19OC800Db." \
"eludFr0AXuJUSrMHi/iPYhKRlPFeqJxlye', " \ 
"1, NULL, '2022-07-04 15:52:04', '192.168.136.1', " \
"0, 'user{}', '{}', '', '', '', 0, " \
"'2019-04-20 22:17:43', '2022-07-04 15:52:04', 0);"
# 添加地址的SQL语句
address_sql = "INSERT INTO 'litemall'.'litemall_address' ('id'," \
" 'name', 'user_id', 'province', 'city', 'county', " \
"'address_detail', 'area_code', 'postal_code', " \
"'tel', 'is_default', 'add_time', 'update_time'," \
" 'deleted') VALUES ({}, 'user{}', {}, '北京市'," \
" '市辖区', '东城区', '长安街1000号', '110101', '', " \
"'{}', 0, '2022-06-30 17:57:07', '2022-06-30 17:57:07', 0);" 
# 循环插入数据 
user_start = 10000  31for i in range(10000):
user_id = user_start + i  33    mobile = "13011" + str(user_id)
address_id = user_start + i
print("插入第{}条用户数据,用户ID为{}".format(i+1,user_id))
cursor.execute(user_sql.format(user_id,user_id,
                               user_id,mobile))
cursor.execute(address_sql.format(address_id, 
                                  user_id, user_id, mobile))
conn.commit()  
# 关闭游标 
cursor.close()  
# 关闭连接 
conn.close() 
~~~



### 5.5.4 项目数据库连接

轻商城项目搭建完成之后，为了更好地完成后续测试，需要连接轻商城数据库。为了便于操作，选择带有图形界面的数据库管理工具连接数据库，带有图形界面的数据库管理工具较多，例如DBeaver、navicat等。由于DBeaver工具是开源的、跨平台的，并且支持多种数据库，所以本书选择使用DBeaver。

~~~properties
安装连接数据库：https://ewm.proedu.com.cn/previewPdf/1183186

IP：192.168.208.128
用户名：root
密码：123456
~~~



### 5.5.5 性能测试需求分析

在开展性能测试之前，测试人员需要获取并分析性能测试的需求，然后提取项目中需要进行性能测试的业务功能。性能测试需求分析的具体内容可以扫描下方二维码进行查看。

~~~properties
性能测试需求分析：https://ewm.proedu.com.cn/previewPdf/1183187
~~~

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428135203677.png" alt="image-20250428135203677" style="zoom:67%;" />

在分析性能测试需求时，可以从业务角度和技术角度提取性能测试的业务功能。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428135254181.png" alt="image-20250428135254181" style="zoom:67%;" />

下面介绍轻商城待测业务功能的接口信息。

#### 1. 登录

- 请求方法：POST。
- 请求地址：http://litemall.itheima.net:8080/wx/auth/login。
- 请求头：Content-Type: application/json;charset=utf-8。
- 请求体：{"username":"user123","password":"user123"}。



#### 2. 首页

- 请求方法：GET。
- 请求地址：http://litemall.itheima.net:8080/wx/home/index。



#### 3.搜索商品

- 请求方法：GET。
- 请求地址：http://litemall.itheima.net:8080/wx/home/index。



#### 4.查看商品详情

- 请求方法：GET。
- 请求地址：http://litemall.itheima.net:8080/wx/goods/detail?id=1181000。



#### 5.加入购物车

- 请求方法：POST。
- 请求地址：http://litemall.itheima.net:8080/wx/cart/add。
- 请求头：Content-Type: application/json;charset=utf-8。
- 请求体：{"goodsId":"1181000","number":"1","productId":"2"}。



#### 6. 查看购物车

- 请求方法：GET。
- 请求地址：http://litemall.itheima.net:8080/wx/cart/goodscount。



#### 7. 选择商品

- 请求方法：POST。
- 请求地址：http://litemall.itheima.net:8080/wx/cart/checked HTTP/1.1。
- 请求头：Content-Type: application/json;charset=utf-8。
- 请求体：{"productIds":[232,31],"isChecked":1}。



#### 8.商品结算

- 请求方法：GET。
- 请求地址:http://litemall.itheima.net:8080/wx/cart/checkout?cartId=0&addressId=0&
  couponId=0&userCouponId=0&grouponRulesId=0。



#### 9.提交订单

- 请求方法：POST。
- 请求地址：http://litemall.itheima.net:8080/wx/order/submit。
- 请求头：Content-Type: application/json;charset=utf-8。
- 请求体：{"addressId":"2","cartId":"0","couponId":"0","userCouponId":"0",
  "grouponLinkId":0,"grouponRulesId":0,"message":""}。



#### 10. 查看订单

- 请求方法：GET。
- 请求地址：http://litemall.itheima.net:8080/wx/order/list?showType=0&
  page=1&limit=10。



### 5.5.6 制定性能测试计划

性能测试计划是性能测试过程中的一份指导性文档，主要从测试目的、测试范围、测试策略、测试进度与分工这4个方面制定轻商城项目的性能测试计划，具体内容可以扫描下方二维码进行查看。

~~~properties
https://ewm.proedu.com.cn/previewPdf/1183188
~~~

#### 1.测试目的

本次测试的目的是确定项目核心业务的TPS，对业务流程进行负载测试，确保项目能够稳定运行24小时或更长一段时间，并监控服务器资源使用率。

#### 2.测试范围

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428152846763.png" alt="image-20250428152846763" style="zoom:80%;" />

#### 3.测试策略

轻商城项目的测试策略主要有3点，具体如下。

- 基准测试：先对需要测试的业务功能进行基准测试，确定估算的标准。
- 负载测试：分别模拟5、10、30、50、100个用户对系统进行负载测试，查看不同并发时系统各项指标是否符合需求。



#### 4.测试进度与分工

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428153006010.png" alt="image-20250428153006010" style="zoom: 80%;" />



### 5.5.7 设计性能测试用例

~~~properties
设计轻商城项目的性能测试：https://ewm.proedu.com.cn/previewPdf/1183211
~~~

按照测试计划的要求，设计轻商城项目的性能测试用例，如下表所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428153733108.png" alt="image-20250428153733108" style="zoom:80%;" />

并发用户数与事务响应如下表所示。

| **并发用户数** | **事务平均响应时间** | **事务最大响应时间** | **平均每秒处理事务数** | **事务成功率** |
| -------------- | -------------------- | -------------------- | ---------------------- | -------------- |
| **5**          |                      |                      |                        |                |
| **10**         |                      |                      |                        |                |
| **30**         |                      |                      |                        |                |
| **50**         |                      |                      |                        |                |
| **100**        |                      |                      |                        |                |

并发用户数与应用服务器性能如下表所示。

| **并发用户数** | **CPU利用率** | **内存利用率** | **磁盘IO情况** | **其他参数** |
| -------------- | ------------- | -------------- | -------------- | ------------ |
| **5**          |               |                |                |              |
| **10**         |               |                |                |              |
| **30**         |               |                |                |              |
| **50**         |               |                |                |              |
| **100**        |               |                |                |              |

并发用户数与数据库性能如下表所示。

| **并发用户数** | **CPU利用率** | **内存利用率** | **磁盘IO情况** | **其他参数** |
| -------------- | ------------- | -------------- | -------------- | ------------ |
| **5**          |               |                |                |              |
| **10**         |               |                |                |              |
| **30**         |               |                |                |              |
| **50**         |               |                |                |              |
| **100**        |               |                |                |              |

### 5.5.8 编写测试脚本

在JMeter中编写测试脚本的基本结构包括添加HTTP请求默认值、用户定义的变量、HTTP信息头管理器、线程组、查看结果树和聚合报告，下面根据该基本结构分别编写轻商城项目的业务流程测试脚本。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154040186.png" alt="image-20250428154040186" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154058781.png" alt="image-20250428154058781" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154119347.png" alt="image-20250428154119347" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154143306.png" alt="image-20250428154143306" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154204807.png" alt="image-20250428154204807" style="zoom:80%;" />

为了保证线程组每次启动时使用不同的用户名进行登录，可以添加一个计数器。在JMeter主界面选中“线程组-业务流程”并右键单击，在弹出的快捷菜单中依次选择“添加”->“配置元件”->“计数器”，会添加一个计数器界面，在该界面设置计数器信息，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154251337.png" alt="image-20250428154251337" style="zoom:80%;" />

**（1） 添加响应断言**

选中登录HTTP请求并右键单击，在弹出的快捷菜单中依次选择“添加”“断言”“响应断言”，会添加一个响应断言界面，在该界面设置响应断言信息，如下图所示。

![image-20250428154423378](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154423378.png)

**（2） 添加JSON断言**

选中登录HTTP请求并右键单击，在弹出的快捷菜单中依次选择“添加”“断言”“JSON断言”，会添加一个JSON断言界面，在该界面设置JSON断言信息，如下图所示。

![image-20250428154501604](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154501604.png)

**（3） JSON提取器**

选中登录HTTP请求并右键单击，在弹出的快捷菜单中依次选择“添加”“后置处理器” “JSON提取器”，会添加一个JSON提取器界面，在该界面设置JSON提取器的信息，如下图所示。

![image-20250428154632833](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154632833.png)

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154735076.png" alt="image-20250428154735076" style="zoom:80%;" />

在首页模块的HTTP请求中添加响应断言、JSON断言，其具体配置与登录模块中的响应断言、JSON断言一致。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154821239.png" alt="image-20250428154821239" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154901283.png" alt="image-20250428154901283" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428154920605.png" alt="image-20250428154920605" style="zoom:80%;" />

**添加HTTP信息头管理器**

在JMeter主界面选中加入购物车的HTTP请求并右键单击，在弹出的快捷菜单中依次选择“添加”“配置元件”“HTTP信息头管理器”，会添加一个HTTP信息头管理器界面，单击该界面下方的“添加”按钮会增加一行输入栏，在输入栏中分别填写名称X-Litemall-Token和值${token}，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428155012416.png" alt="image-20250428155012416" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428155032899.png" alt="image-20250428155032899" style="zoom:80%;" />

在结算模块的HTTP请求中添加响应断言、JSON断言和HTTP信息头管理器。其中，响应断言、JSON断言的具体配置与登录模块中的响应断言、JSON断言一致，HTTP信息头管理器的具体配置与加入购物车模块中的HTTP信息头管理器一致。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428155111897.png" alt="image-20250428155111897" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428155130013.png" alt="image-20250428155130013" style="zoom:80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428155155501.png" alt="image-20250428155155501" style="zoom: 80%;" />

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428155223930.png" alt="image-20250428155223930" style="zoom:80%;" />

### 5.5.9 性能测试监控

当确定了轻商城项目的性能测试需求和测试环境，下面具体介绍性能测试监控的过程。

~~~properties
https://ewm.proedu.com.cn/previewPdf/1183213
~~~

#### 1.启动虚拟机

由于轻商城项目部署在虚拟机中，所以在测试前需要打开虚拟机才能访问轻商城，该过程可参考前面的项目部署。

#### 2.启动FinalShell

在监控服务器的资源使用情况，需要通过FinalShell连接虚拟机，并启动ServerAgent服务器。首先打开FinalShell并单击SSH连接（Linux）建立连接，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160218371.png" alt="image-20250428160218371"  />

在新建连接窗口中分别填写名称、主机、用户名（root）和密码（123456），其中主机为虚拟机的IP地址，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160251681.png" alt="image-20250428160251681"  />

当填写完成后，单击“确定”按钮会关闭新建连接窗口，并返回到连接管理器的窗口，双击litemall即可连接虚拟机，如下图所示。

![image-20250428160328731](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160328731.png)

#### 3.启动ServerAgent服务器

首先将成功下载的ServerAgent-2.2.3.zip从Windows系统中拖进FinalShell下方的文件中，或者单击右下角的“上传”按钮，也可以将ServerAgent-2.2.3.zip从Windows系统中上传到虚拟机，然后在FinalShell终端依次输入以下命令。

~~~properties
unzip ServerAgent-2.2.3.zip

cd ServerAgent-2.2.3

chmod –R 777 *

./startAgent.sh
~~~

#### 4. 添加jp@gc - PerfMon Metrics Collector监听器

选中JMeter主界面的 “线程组-业务流程”并右键单击，在弹出的快捷菜单中依次选择“添加”“监听器”“ jp@gc - PerfMon Metrics Collector”，当添加成功后，单击“Add Row”按钮配置需要监控的服务器Host/IP和服务器资源，如CPU、Memory和Network I/O，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160434059.png" alt="image-20250428160434059" style="zoom:80%;" />

#### 5.启动线程组

在JMeter主界面，单击“启动”按钮（   ）进行性能测试监控，由于在编写脚本时，将线程数的初始值设置为5，持续时间为60秒，所以JMeter将在60秒时自动停止监控。完成性能测试监控后，单击察看结果树可以查看“线程组-业务流程”的响应结果，如下图所示。

![image-20250428160517307](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160517307.png)

单击聚合报告，即可查看聚合报告的结果，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160540000.png" alt="image-20250428160540000" style="zoom:80%;" />

单击“线程组-业务流程”下方添加的jp@gc - PerfMon Metrics Collector即可查看服务器资源使用的曲线变化，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160603051.png" alt="image-20250428160603051" style="zoom:80%;" />

虽然可以从jp@gc - PerfMon Metrics Collector界面观察CPU、Memory和Network I/O在60秒内的曲线变化情况，但是并不能得出准确的数据，所以下面需要导出数据，计算CPU、Memory、Network I/O的平均值，作为性能分析和调优的依据。



在曲线界面的任意位置右键单击，会出现一个列表选项，单击该列表选项中的“Export to CSV…”，会弹出一个Save对话框，在该对话框中设置文件的名称，当选择导出文件的位置后，单击“Save”按钮就可以保存导出的文件并关闭Save对话框。双击导出的CSV文件，即可查看服务器资源使用率，如下图所示。

![image-20250428160939523](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428160939523.png)

### 5.5.10 性能分析和调优

~~~properties
性能分析与调优的具体步骤 https://ewm.proedu.com.cn/previewPdf/1183214
~~~

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428161627533.png" alt="image-20250428161627533" style="zoom:80%;" />

值得一提的是，在实际工作中，性能分析和调优需要经过2~3轮，甚至更多轮才能最终解决问题。

通过分析前面计算出的服务器资源使用率可知，在本次测试的轻商城项目实例中，主要产生的性能问题是CPU使用率高，解决该问题的方案是提高服务器配置。



<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428161657407.png" alt="image-20250428161657407" style="zoom:80%;" />

### 5.5.11 性能测试报告

在实际工作中，测试完成后都需要对测试过程进行回顾，并编写测试报告，其核心内容包括测试目的、测试范围、测试环境、测试工具、测试问题记录和分析结果、测试经验总结和教训等。

在本次实例项目的测试中，使用JMeter提供的命令即可自动生成测试报告。



首先进入JMeter解压后的bin目录，打开cmd命令行窗口，然后输入jmeter -n -t “D:\Jmeter5.4.3\轻商城项目测试.jmx” -l result.jtl -e -o ./report命令，并按下Enter键就可以执行该命令，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428161828854.png" alt="image-20250428161828854" style="zoom:67%;" />

当执行完命令后，在bin目录中会自动生成一个report文件夹，该文件夹中的index.html文件即为测试报告，双击index.html文件即可查看性能测试报告，如下图所示。

![image-20250428161903011](F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428161903011.png)

单击性能测试报告左侧的“Charts”还可以查看更详细的超时统计图表、吞吐量统计图表和响应时间统计图表，例如，在左侧依次单击“Charts”→“Response Times”，可以查看每个模块的响应时间统计图表，如下图所示。

<img src="F:\西安用友-汇杰大数据7班\typora-user-images\image-20250428161930214.png" alt="image-20250428161930214" style="zoom:80%;" />











